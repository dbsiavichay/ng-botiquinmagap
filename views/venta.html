<div ng-controller="VentaController">
	<form class="form-horizontal">
  		<fieldset>
    		<legend>Registro de ventas</legend>
			<div class="panel panel-default">
  				<div class="panel-body">
    				<div class="form-group">
					  	<label for="sltAsociacion" class="control-label col-md-2">Asociación</label>
					  	<div class="col-md-10">
					    	<select ng-model="venta.asociacion" ng-options="asociacion.nombre for asociacion in asociaciones" class="form-control" id="sltAsociacion" aria-describedby="sltAsociacionStatus">					      		
					    	</select>    	
					  	</div>  	
					</div>	
				    <div class="form-group">
				      	<label for="sltCliente" class="control-label col-md-2">Cliente</label>
				      	<div class="col-md-4">
				        	<div class="input-group">    					  
      							<input ng-model="venta.cliente.cedula" type="text" class="form-control" placeholder="Cédula">
      							<span class="input-group-btn">
	      							<button  class="btn btn-success" title="Buscar" data-toggle="modal" data-target="#dlgBuscarCliente">
										<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
									</button>
      							</span>
    						</div>				        	
				      	</div>
				      	<div class="col-md-6">
				        	<input ng-model="venta.cliente.nombreCompleto" type="text" class="form-control" placeholder="Nombre" readonly>
				      	</div>
				    </div>	
				    
				    <div class="form-group">
				      	<label for="calFecha" class="control-label col-md-2">Fecha</label>
				      	<div class="col-md-8">
				      		<input ng-model="venta.fecha" type="date" class="form-control">
				      	</div>
				    </div>	
  				</div>
			</div>    		

			<div class="panel panel-default">
  				<div class="panel-body">
					<div ng-show="mensaje" class="alert alert-danger" role="alert">						
						<strong>Error!</strong> {{mensaje}}
					</div>
					<div class="clearfix">						
	  					<button ng-click="agregarDetalle()" class="btn btn-success btn-sm pull-left">
							<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Agregar
						</button>
						<button ng-click="guardarVenta()" class="btn btn-primary btn-sm pull-right">
							<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> 
							<strong>GUARDAR</strong>
						</button>
					</div>
					<hr>
  					<div class="table-responsive">
						<table class="table table-striped table-condensed">
							<thead>
								<tr>
									<th>CANTIDAD</th>
									<th>PRODUCTO</th>
									<th>VALOR UNITARIO</th>
									<th>VALOR TOTAL</th>
									<th>ACCIONES</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-show="detalles.length <= 0">
									<td colspan="5">No existen registros</td>
								</tr>
								<tr ng-repeat="detalle in detalles">
									<td class="col-xs-1">
										<input ng-show="detalle.esActual" ng-model="detalle.cantidad" ng-keyup="calcularTotal($index)" type="text" class="form-control input-sm" id="txtCantidad" placeholder="Ej. 1.12">
										<p ng-hide="detalle.esActual">{{detalle.cantidad}}</p>
									</td>
									<td class="col-xs-5">
										<div ng-show="detalle.esActual" class="input-group input-group-sm">  
      										<input type="text" class="form-control" placeholder="Buscar producto" value="{{detalle.producto.nombre}}" readonly>
      										<span class="input-group-btn">
		      									<button ng-click="setDetalleActual(detalle)" class="btn btn-success" title="Buscar" data-toggle="modal" data-target="#dlgBuscarProducto">
													<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
												</button>
			      							</span>
			    						</div>
			    						<p ng-hide="detalle.esActual">{{detalle.producto.nombre}}</p>
									</td>
									<td class="col-xs-2">
										<input ng-show="detalle.esActual" ng-model="detalle.valorUnitario" ng-keyup="calcularTotal($index)" type="text" class="form-control input-sm" id="txtValorUnitario" placeholder="Precio del producto">
										<p ng-hide="detalle.esActual">{{detalle.valorUnitario}}</p>
									</td>
									<td class="col-xs-2">
										<input ng-show="detalle.esActual" type="text" class="form-control input-sm" id="txtValorTotal" value="{{detalle.valorTotal}}" readonly>
										<p ng-hide="detalle.esActual">{{detalle.valorTotal}}</p>
									</td>
									<td class="col-xs-2">
										<button ng-click="setDetalleActual(detalle)" class="btn btn-danger btn-sm" title="Registro de usos" data-toggle="modal" data-target="#dlgUsos">
											<strong>USOS</strong>
										</button>										
										<button ng-click="editarDetalle($index)" class="btn btn-primary btn-sm">
											<span pan class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
										</button>
										<button ng-click="eliminarDetalle($index)" class="btn btn-primary btn-sm">
											<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
										</button>
									</td>
								</tr>								
							</tbody>
						</table>
					</div>
			    </div>				    
			</div> 		    
  		</fieldset>
	</form>

	<!-- Dialogos -->	
	<div class="modal fade" id="dlgUsos">
	 	<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">Registro de usos</h4>
				</div>
				<div class="modal-body">
					<div ng-show="usoActual.error" class="alert alert-danger" role="alert">
						<strong>Error!</strong> {{usoActual.mensajeError}}
					</div>
					<div class="row">						
						<div id="cantidadUsos" class="col-xs-2 input-inline">
							<input ng-model="usoActual.cantidad" type="text" class="form-control" placeholder="Ej. 1.12">
						</div>	
						
						<div id="enfermedadUsos" class="col-xs-4 input-inline">
							<select ng-model="usoActual.enfermedad" ng-options="enfermedad.nombre for enfermedad in enfermedades" class="form-control">
								<option value="">-- Enfermedad --</option>								
							</select>							
						</div>
						<div id="especieUsos" class="col-xs-4 input-inline">
							<select ng-model="usoActual.especie" ng-options="especie.nombre for especie in especies" class="form-control">
								<option value="">-- Especie --</option>
							</select>							
						</div>
						<div class="col-xs-2 input-inline">							
							<button ng-click="agregarUso()" class="btn btn-default">ACEPTAR</button>
						</div>
					</div>
					<hr>
					<div class="table-responsive">
						<table class="table table-striped table-condensed">
							<thead>
								<tr>
									<th>CANTIDAD</th>
									<th>ENFERMEDAD</th>
									<th>ESPECIE</th>									
									<th>ACCIONES</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-show="detalleActual.usos.length <= 0">
									<td colspan="5">No existen registros</td>
								</tr>
								<tr ng-repeat="uso in detalleActual.usos">
									<td class="col-xs-2">
										<input ng-show="uso.esActual" ng-model="uso.cantidad" type="text" class="form-control input-sm" placeholder="Ej. 1.12">
										<p ng-hide="uso.esActual">{{uso.cantidad}}</p>
									</td>
									<td class="col-xs-4">
										<select ng-show="uso.esActual" ng-model="uso.enfermedad" ng-options="enfermedad.nombre for enfermedad in enfermedades" class="form-control input-sm">											
										</select>
										<p ng-hide="uso.esActual">{{uso.enfermedad.nombre}}</p>
									</td>
									<td class="col-xs-4">
										<select ng-show="uso.esActual" ng-model="uso.especie" ng-options="especie.nombre for especie in especies" class="form-control input-sm">											
										</select>
										<p ng-hide="uso.esActual">{{uso.especie.nombre}}</p>
									</td>									
									<td class="col-xs-2">										
										<button ng-click="editarUso($index)" class="btn btn-primary btn-sm">
											<span pan class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
										</button>
										<button ng-click="eliminarUso($index)" class="btn btn-primary btn-sm">
											<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
										</button>
									</td>
								</tr>								
							</tbody>
						</table>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">Aceptar</button>
				</div>
			</div>
		</div>
	</div>

	<buscarcliente-dialog name="dlgBuscarCliente"></buscarcliente-dialog>
	<buscarproducto-dialog name="dlgBuscarProducto"></buscarcliente-dialog>	

</div> 